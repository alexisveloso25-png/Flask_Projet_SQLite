<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mes Objectifs</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; padding: 50px; }
        .container { width: 100%; max-width: 500px; background: #1e293b; padding: 20px; border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        h2 { text-align: center; color: #3b82f6; }
        
        .form-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        input { padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; }
        button#add-btn { background: #3b82f6; color: white; border: none; padding: 12px; cursor: pointer; font-weight: bold; border-radius: 6px; }
        button#add-btn:hover { background: #2563eb; }

        .task-list { margin-top: 20px; }
        .task-item { background: #334155; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .task-item.done span { text-decoration: line-through; color: #94a3b8; }
        
        .btns { display: flex; gap: 5px; }
        .btn-status { background: #10b981; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .btn-del { background: #ef4444; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸŽ¯ Mes Objectifs</h2>
    
    <div class="form-group">
        <input type="text" id="taskTitle" placeholder="Quoi faire ?">
        <input type="date" id="taskDate">
        <button id="add-btn" onclick="addNewTask()">Ajouter maintenant</button>
    </div>

    <div id="taskList" class="task-list">
        </div>
</div>

<script>
    // 1. Charger les tÃ¢ches au chargement de la page
    window.onload = loadTasks;

    async function loadTasks() {
        const response = await fetch('/api/tasks');
        const tasks = await response.json();
        const list = document.getElementById('taskList');
        list.innerHTML = ''; // On vide pour reconstruire

        tasks.forEach(task => {
            const div = document.createElement('div');
            div.className = `task-item ${task.is_completed ? 'done' : ''}`;
            div.innerHTML = `
                <span><strong>${task.title}</strong> <br> <small>${task.due_date}</small></span>
                <div class="btns">
                    <button class="btn-status" onclick="toggleTask(${task.id})">âœ”</button>
                    <button class="btn-del" onclick="deleteTask(${task.id})">âœ–</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    // 2. Ajouter une tÃ¢che
    async function addNewTask() {
        const title = document.getElementById('taskTitle').value;
        const date = document.getElementById('taskDate').value;

        if(!title) return alert("Mets un titre !");

        await fetch('/api/tasks', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ title: title, due_date: date })
        });

        document.getElementById('taskTitle').value = ''; // On vide le champ
        loadTasks(); // On rafraÃ®chit la liste visuelle
    }

    // 3. Cocher/DÃ©cocher
    async function toggleTask(id) {
        await fetch(`/api/tasks/${id}/toggle`, { method: 'POST' });
        loadTasks();
    }

    // 4. Supprimer
    async function deleteTask(id) {
        if(confirm("Supprimer ?")) {
            await fetch(`/api/tasks/${id}`, { method: 'DELETE' });
            loadTasks();
        }
    }
</script>

</body>
</html>
